# 修改记录 (Changelog)

本文档记录了 Simple Log (slog) 项目的所有重要变更。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [v0.5] - 2026-02-04

### 重构

- 重构日志Sink基类的实现，引入rule_level的概念，为了解决全局日志等级继承的问题

### 问题修正

- 旧版本的全局日志等级，会影响clone的logger对象
比如：设定全局logger等级为：service_main:Debug, 它会将由service_main克隆的logger的日志等级也修改为Debug。



## [v0.4] - 2026-01-21

### 新增功能

- 支持多行日志输出函数 log_lines()

### 问题修正

- 修复dump()函数不起作用的问题

## [v0.3] - 2025-12-04

### 新增功能

#### 核心功能
- **文件 Sink 实现**：新增完整的文件日志输出功能
  - 支持线程安全的文件写入
  - 支持自动文件轮转（按文件大小）
  - 支持同时输出到文件和标准输出
  - 支持多 logger 写入同一文件
  - 使用 `stat()` 替代 `filesystem` 以提升兼容性

- **Spdlog 集成**：新增基于 spdlog 的 Sink 支持（可选功能）
  - 支持 console 和 file logger
  - 支持同步和异步模式
  - 多线程安全
  - 无缓存设计，确保日志及时写入
  - 格式与 simple_log 保持一致

- **Logger 克隆功能**：支持从现有 logger 克隆新的 logger 对象
  - 支持克隆时指定新的日志等级
  - 确保克隆的 logger 名称唯一
  - 支持从默认 logger 克隆，便于子模块开发

- **全局日志等级规则**：支持在 logger 创建前设置全局规则
  - 支持精确匹配规则
  - 支持正则表达式匹配规则
  - 支持通配符模式（自动转换为正则表达式）
  - 精确匹配优先于正则匹配

- **日志抑制功能**：限制特定 tag 的日志输出次数
  - 避免日志泛滥问题
  - 支持重置计数器
  - 支持所有日志等级的抑制功能

#### 版本管理
- **版本号支持**：添加版本号定义和管理
  - 在 `slog.hpp` 中定义版本号宏
  - 提供版本号应用脚本 `version_apply.sh`
  - CMake 自动同步版本号

#### 构建和配置
- **CMake 配置优化**：
  - 重构配置选项，使用 `SLOG_` 前缀避免冲突
  - 支持 `SLOG_SINK_SPDLOG` 选项（默认开启）
  - 支持 `SLOG_EXTERNAL_LIBFMT` 选项（默认开启）
  - 默认构建为共享库
  - 添加安装规则

- **安装支持**：添加完整的安装规则
  - 安装头文件
  - 安装库文件
  - 安装 CMake 配置文件

#### 文档和示例
- **README 增强**：
  - 添加详细的文件日志使用示例
  - 添加自动轮转示例
  - 添加多线程使用示例
  - 添加从默认 logger 克隆的示例
  - 添加动态库中使用日志的最佳实践

- **性能测试**：
  - 添加性能测试程序
  - 添加快速、标准、压力测试脚本
  - 添加性能测试文档

- **示例代码**：添加 spdlog 集成示例

#### 工具和脚本
- **VSCode 配置脚本**：添加 `setup_vscode.sh` 脚本
  - 自动生成 VSCode 和 clangd 配置
  - 移除旧的配置文件

### 改进

- **线程安全增强**：
  - 改进 `get_default` 方法的线程安全性
  - 增强 logger 注册过程的线程安全
  - 改进 Stdout sink 的线程安全实现

- **Sink 克隆过程优化**：
  - 确保克隆时正确配置 logger
  - 改进克隆过程中的 logger 配置传递

- **`get_logger` 行为增强**：
  - 改进 logger 查找和创建逻辑
  - 支持从默认 logger 自动克隆

- **宏重命名**：
  - 将 `LOGGER_XXX` 重命名为 `LOCAL_XXX`，避免命名冲突

### 修复

- 修复文件 Sink 的兼容性问题（使用 `stat()` 替代 `filesystem`）
- 修复 CMake 配置中的各种问题
- 修复安装规则相关问题

### 技术细节

- 使用 C++14 标准（兼容 gcc 7.5 等较旧编译器）
- 支持系统 fmt 库或内置 fmt 库
- 支持可选 spdlog 集成
- 所有操作都是线程安全的

---

## 版本说明

- **主版本号**：不兼容的 API 修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正
